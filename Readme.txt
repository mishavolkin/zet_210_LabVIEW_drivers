Пролог

"Мы не разрабатываем и не поддерживаем библиотек для работы с ПО сторонних производителей. Но если с этими библиотеками делятся наши потребители, которые они разрабатывают сами, то мы с удовольствием размещаем их у себя на сайте. Для выполнения Ваших задач, скорее всего подойдет наша SCADA система ZETView."

			Усман Фейзханов ZETLAB, форум ЗАО "ЭТМС"




0. Содержание
	1. Установка
	2. Введение.
	3. Глоссарий.



			1. Установка

Для работы необходимо:
• Win XP или Win 7 (другие версии не проверял)
• LabVIEV 7.1 или 7.1.1
• ZetLab

1) Установить ZetLab, убедиться что устройство работает.
2) Установить LabVIEV, если не был установлен ранее
3) Скопировать \Z210 в %Program Files%\National Instruments\LabVIEW 7.1\instr.lib\




			2. Введение.

По всей вероятности, вы уже купили устройство Zet 210, и надеясь работать с ним в среде LabVIEW, увидев опубликованный драйвер на сайте zetms.ru. Увы, ЗАО "ЭТМС" не занимается разработкой этих драйверов, оно только "с удовольствием размещаем их у себя на сайте", забывая указать, что это не официальный продукт (и вводя потенциальных покупателей в заблуждение). Я накололся точно так же.

Что касается общей структуры, я взял за основу опубликованный на сайте "драйвер", однако практически все пришлось переписать. Именование, впрочем, пришлось тоже отчасти изменить. Корректно реализована обработка ошибок. Убраны функции Zadc.dll не поддерживаемые устройством Zet 210. Все остальное имеет справку, появляющуюся в Context Help. Я отошел от терминологии, используемой в документации по динамической библиотеке Zadc.dll, опеспечивающей подключение к устройству (по ходу, её за зачет писал какой-то студент). См. раздел Глоссарий. Так же полезна директория Z210 Tests & Examples. Если после всего у Вас останутся вопросы, попробуйте мне написать. Адрес электропочты найдете на githab'е. Только поните, что я — не служба поддержки ЗАО "ЭТМС"


Драйвера поставляются в виде набора библиотек, сгруппированных следующим образом:
• Routines — собственно драйверы — набор функций, позволяющий совершать конкретные осмысленные действия над устройством с уверенностью, что все будет сделано так как надо (или вызовет ошибку). Умное включение каналов, включение каналов пачкой, умная установка частоты (с возможностью автоматом получить min или max возможную), и т.д. Подразумевается, что это основные "кирпичики" для построения приложений. Возможно, в последствии, функции будут дополнительно сгруппированы.
• Base Functions — обертки (врапперы) для функций динамической библиотеки Zadc.dll, обеспечивающие правильный вызов, согласование типов (в т.ч. и физических единиц) и обработку кодов ошибок. Обертки повторяют функционал Zadc.dll за исключением Get List Freq, которая на самом деле возвращает список (а не подразумевает множественные вызовы себя, для его получения). Иконки стилизованы под Call Library Function Node, что символизирует :) Обычно, нет необходимости применять функции из Base Functions при разработке собственных приложений.
• CTL Lib — библиотека содержит определения частоиспольземых в функциях из Base Functions и Routines типов данных (Strict type def). Как и функции, каждый контрол имеет описание, выводящееся в окне Context Help.

Как читать название функции
Z210 ROUTINE ADB All Channels Turn Off
Z210 - все функции имеют такой префикс. Поскольку тестировать я могу только на устройстве Zet 210, а железо имеет ньюанся и динамическая библиотека подключения к драйверу устройства документирована плохо, трудно сказать будет ли работать данная функция с другими устройствами от ЗАО "ЭТМС", несмотря на то, что в основе всех драйверов лежит Zadc.dll, которая по идее должна обеспечивать совместимость.
	 ROUTINE — область применения
			 ADB — A - применимо к АЦП.
				   D - применимо к ЦАП.
				   B - применимо к АЦП и ЦАП одновременно. 
				Если использовано несколько букв, значит можно выбрать из вариантов. Если доступен выбор, то по умолчанию используется B, затем A. Если букв нет, значит функция не имеет непосредственного отношения к АЦП или ЦАП (напр. Connect и Disconnect)
					Channels Turn Off — название функции

Контролы расшифровываются аналогично.




			3. Глоссарий.
			
			
Выводы АЦП/ЦАП (ADC/DAC Inputs) — контакты соответстующих микросхем. Выводы пронумерованы начиная с 0. Base Functions включающие и отключающие каналы принимают на вход номер вывода. Канал определяются номером вывода.

Канал АЦП/ЦАП (ADC/DAC Channels) — виртуальные/программные каналы. Каналы АЦП могут быть двух типов: синфазные, занимающие один вывод, и дифференциальные, занимающие два соседних вывода. Контролы "Z210 CTL ADC Inputs.ctl" и "Z210 CTL DAC Inputs.ctl" определяют структуры данных, сопоставляющие каналы с выводами, на которых они расположены. Контролы "Z210 CTL ADC Voltages.ctl" и "Z210 CTL DAC Voltages.ctl" определяют структуры данных, сопоставляющие каналы с текущими значениями поданых на них (генерируемых ими) напряжений.


Буфер АЦП/ЦАП — (Буффер данных в ОЗУ ПК) массив 16-битных знаковых целых чисел (для устройства Zet 210) в который происходит циклическая запись данных, получаемых с АЦП/откуда происходит циклическое считывание данных, по которым формируется сигнал ЦАП. Данные группируются по кадрам.

Кадр — порция данных, расположенная в буфере данных и содержащая одномоментные напряжения по всем каналам.

Внутренний буфер — буфер в устройстве, где накапливаются данные для последующей пакетной передачи по USB.

Пакет — порция данных, которая перекачивается за одно прерывание. Связанное понятие — буффер для перекачки данных за одно прерывание, он же буффер прерывания. Размер этого буффера задан жестко (т.к. Zet210 — USB контроллер, ZGetInterrupt чтобы узнать), и составляет ровно 2 пакета.

АЦП-процесс — собирательное понятие для непрерывно и параллельно идущих процессов: оцифровки сигнала, накопления оцифрованных данных во внутреннем буффере устройства Z210 и пакетной пересылки накопленных данных в буффер данных АЦП (расположенный в памяти ПК).
ЦАП-процесс — собирательное понятие для непрерывно и параллельно идущих процессов: пакетной пересылки подготовленных данных из буффера данных ЦАП (расположенного в памяти ЦП) во внутренний буффер устройства и генерации аналогового сигнала по этим данным.

______________
похоже, что size везде меряется в 16-разрядных словах.

Видимо АЦП-процесс и ЦАП-процесс можно перевести на английский как sampling, но я не уверен.